define(["modals/modals","config"],function(e,t){e.factory("User",["$resource","$q","$location","Storage","$rootScope",function(e,t,n,r,i){var s=e(),o=e($config.host+"/login",{},{process:{method:"GET",params:{username:"",password:""}}}),u=e($config.host+"/logout",{},{process:{method:"GET",params:{}}}),a=e($config.host+"/accounts/contactinfos/owner",{},{query:{method:"GET",params:{},isArray:!0},create:{method:"POST",params:{}},get:{method:"GET",params:{tag:""}}});return s.prototype.login=function(e,n){var r=t.defer();return o.process({username:e,password:n},function(e){angular.equals(e,[])?r.reject("Something went wrong with login!"):r.resolve(e)},function(e){r.resolve(e)}),r.promise},s.prototype.logout=function(){var e=t.defer();return u.process(null,function(t){e.resolve(t)},function(t){e.resolve({error:t})}),e.promise},s.prototype.owner={get:function(){return angular.fromJson(r.get("resources"))},set:function(e){r.add("resources",angular.toJson(e)),this.process(e)},process:function(e){if(e){var t={};angular.forEach(e,function(e){switch(e.contactInfoTag){case"Name":t.name=e.contactInfo;break;case"Phone":t.phone=e.contactInfo;break;case"Email":t.email=e.contactInfo;break;case"Address":t.address=e.contactInfo;break;case"PURCHASED_NUMBER":t.purchasedNumber=e.contactInfo}}),e[0]&&(t.id=e[0].ownerKey),i.app.resources=t}}},s.prototype.resources=function(){var e=t.defer();return a.query(null,function(t){angular.equals(t,[])?e.reject("User has no resources!"):(s.prototype.owner.set(t),e.resolve(t))},function(t){e.resolve({error:t})}),e.promise},new s}])});