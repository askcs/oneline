define(["controllers/controllers"],function(e){e.controller("overview",["$rootScope","$scope","Core","Storage",function(e,t,n,r){function d(e){e.children&&(e.children.forEach(d),m(e))}function v(e){var t=d3.event&&d3.event.altKey?5e3:500,n=c.nodes(l).reverse();n.forEach(function(e){e.y=e.depth*180});var r=p.selectAll("g.node").data(n,function(e){return e.id||(e.id=++f)}),i=r.enter().append("svg:g").attr("class","node").attr("transform",function(t){return"translate("+e.y0+","+e.x0+")"}).on("click",function(e){m(e),v(e)});i.append("svg:circle").attr("r",1e-6).style("fill",function(e){return e._children?"lightsteelblue":"#fff"}),i.append("svg:text").attr("x",function(e){return e.children||e._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(e){return e.children||e._children?"end":"start"}).text(function(e){return e.name}).style("fill-opacity",1e-6);var s=r.transition().duration(t).attr("transform",function(e){return"translate("+e.y+","+e.x+")"});s.select("circle").attr("r",4.5).style("fill",function(e){return e._children?"lightsteelblue":"#fff"}),s.select("text").style("fill-opacity",1);var o=r.exit().transition().duration(t).attr("transform",function(t){return"translate("+e.y+","+e.x+")"}).remove();o.select("circle").attr("r",1e-6),o.select("text").style("fill-opacity",1e-6);var u=p.selectAll("path.link").data(c.links(n),function(e){return e.target.id});u.enter().insert("svg:path","g").attr("class","link").attr("d",function(t){var n={x:e.x0,y:e.y0};return h({source:n,target:n})}).transition().duration(t).attr("d",h),u.transition().duration(t).attr("d",h),u.exit().transition().duration(t).attr("d",function(t){var n={x:e.x,y:e.y};return h({source:n,target:n})}).remove(),n.forEach(function(e){e.x0=e.x,e.y0=e.y})}function m(e){e.children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null)}e.fixStyles();var i={name:e.data.account.name,children:[{name:"Account details",children:[{name:"Email",children:[{name:e.data.account.email}]},{name:"Address",children:[{name:e.data.account.address}]},{name:"Phone",children:[{name:e.data.account.phone}]}]},{name:"Connected numbers",children:[]},{name:"Blacklisted numbers",children:[]},{name:"Notification settings",children:[{name:"SMS",children:[]},{name:"Email",children:[]}]},{name:"Scenario",children:[]}]};angular.forEach(e.data.connected.list,function(e){i.children[1].children.push({name:e.label+", "+e.contactInfo+(e.verified?", Verified":", Not verified")})}),angular.forEach(e.data.blacklist.list,function(e){i.children[1].children.push({name:e.label+", "+e.contactInfo})}),angular.forEach(angular.fromJson(r.get("connections")),function(t){e.data.settings.sms.target===t.id&&i.children[3].children[0].children.push({name:t.contactInfo}),e.data.settings.email.target===t.id&&i.children[3].children[1].children.push({name:t.contactInfo})});var s=angular.fromJson(r.get("scenario"))||{};angular.forEach(s.steps,function(e){i.children[4].children.push({name:"ID: "+e.id+", address: "+e.redirect.address+", continue: "+e.redirect.continue.next+", exception: "+e.redirect.exception.next+", timeout: "+e.redirect.timeout.value})});var o=[20,120,20,120],u=1280-o[1]-o[3],a=800-o[0]-o[2],f=0,l,c=d3.layout.tree().size([a,u]),h=d3.svg.diagonal().projection(function(e){return[e.y,e.x]}),p=d3.select("#birdseye").append("svg:svg").attr("width",u+o[1]+o[3]).attr("height",a+o[0]+o[2]).append("svg:g").attr("transform","translate("+o[3]+","+o[0]+")");l=i,l.x0=a/2,l.y0=0,v(l)}])});