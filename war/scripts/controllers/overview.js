define(["controllers/controllers"],function(e){e.controller("overview",["$rootScope","$scope",function(e,t){function p(e){e.children&&(e.children.forEach(p),v(e))}function d(e){var t=d3.event&&d3.event.altKey?5e3:500,n=l.nodes(f).reverse();n.forEach(function(e){e.y=e.depth*180});var r=h.selectAll("g.node").data(n,function(e){return e.id||(e.id=++a)}),i=r.enter().append("svg:g").attr("class","node").attr("transform",function(t){return"translate("+e.y0+","+e.x0+")"}).on("click",function(e){v(e),d(e)});i.append("svg:circle").attr("r",1e-6).style("fill",function(e){return e._children?"lightsteelblue":"#fff"}),i.append("svg:text").attr("x",function(e){return e.children||e._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(e){return e.children||e._children?"end":"start"}).text(function(e){return e.name}).style("fill-opacity",1e-6);var s=r.transition().duration(t).attr("transform",function(e){return"translate("+e.y+","+e.x+")"});s.select("circle").attr("r",4.5).style("fill",function(e){return e._children?"lightsteelblue":"#fff"}),s.select("text").style("fill-opacity",1);var o=r.exit().transition().duration(t).attr("transform",function(t){return"translate("+e.y+","+e.x+")"}).remove();o.select("circle").attr("r",1e-6),o.select("text").style("fill-opacity",1e-6);var u=h.selectAll("path.link").data(l.links(n),function(e){return e.target.id});u.enter().insert("svg:path","g").attr("class","link").attr("d",function(t){var n={x:e.x0,y:e.y0};return c({source:n,target:n})}).transition().duration(t).attr("d",c),u.transition().duration(t).attr("d",c),u.exit().transition().duration(t).attr("d",function(t){var n={x:e.x,y:e.y};return c({source:n,target:n})}).remove(),n.forEach(function(e){e.x0=e.x,e.y0=e.y})}function v(e){e.children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null)}e.fixStyles();var n=e.rootNodes,r={};angular.forEach(n,function(e){r[e.ownerKey]=[]}),angular.forEach(n,function(e){if(e.contactInfos.length>0){var t=[];angular.forEach(e.contactInfos,function(e){t.push({name:e.contactInfoTag})}),e.children=t}r[e.ownerKey].push(e)});var i={name:"Root",children:[]};angular.forEach(r,function(e,t){i.children.push({name:t,children:angular.forEach(e,function(e){return{name:e.name+"( "+e.id+" )"}})})}),t.toggleAll=function(){f.children.forEach(p),d(f)};var s=[20,120,20,120],o=1280-s[1]-s[3],u=800-s[0]-s[2],a=0,f,l=d3.layout.tree().size([u,o]),c=d3.svg.diagonal().projection(function(e){return[e.y,e.x]}),h=d3.select("#birdseye").append("svg:svg").attr("width",o+s[1]+s[3]).attr("height",u+s[0]+s[2]).append("svg:g").attr("transform","translate("+s[3]+","+s[0]+")");f=i,f.x0=u/2,f.y0=0,d(f)}])});